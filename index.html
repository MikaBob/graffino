<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Perez--Delacour MikaÃ«l - Graffino progressive test</title>
        <link href="stylesheet.css" type="text/css" rel="stylesheet" />
    </head>
    <body>
        <div class="form-container float-left">
            <form onsubmit="return false;">
                <label for="width">Width</label>
                <input id="width" name="width" type="text" value="20"/>
                <label for="height">Height</label>
                <input id="height" name="height" type="text" value="30"/>
                <label for="start">Start</label>
                <input id="start" name="start" type="text" value="0;1"/>
                <label for="end">End</label>
                <input id="end" name="end" type="text" value="15;20"/>
                <label for="density">Density</label>
                <input id="density" name="density" type="text" value="0.4"/>
                <button id="generate" name="generate">Generate maze</button>
                <button id="moveForm" name="moveForm">Move form</button>
                <button id="solve" name="solve">Solve maze</button>
            </form>
        </div>
        <div class="messages-container">
            <span class="feedback"></span>
            <span class="error"></span>
        </div>

        <div id="maze-container"></div>


        <script src="https://cdn.jsdelivr.net/npm/p5@1.3.1/lib/p5.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <script src="Maze.js"></script>
        <script src="Cell.js"></script>
        <script>
            var maze = null;
            var formIsOnRight = false;
            $('#moveForm').click(()=>{
                $('.form-container').removeClass("float-left");
                $('.form-container').removeClass("float-right");

                $('.form-container').addClass(formIsOnRight ? "float-left" : "float-right");
                formIsOnRight = !formIsOnRight;
            });

            $('#generate').click(()=>{
                let width = parseInt($("#width").val()),
                height = parseInt($("#height").val()),
                start = $("#start").val(),
                end = $("#end").val(),
                density = $("#density").val();

                if(Maze.validate(width, height, start, end, density)){
                    maze = new Maze(width, height, {x: parseInt(start.split(";")[0]), y: parseInt(start.split(";")[1])}, {x: parseInt(end.split(";")[0]), y: parseInt(end.split(";")[1])}, density);

                } else {
                    $("#error").text("Invalid values");
                    maze = null;
                }
            });

            $('#solve').click(()=>{
                if(maze.hasASolution()) {
                    maze.path.forEach((cell) => {
                        cell.type = Cell.TYPE_PATH;
                    });
                } else {
                    for(let i = 0 ; i < maze.width; i++){
                        for(let j = 0 ; j < maze.height; j++){
                            maze.cells[i][j].type = maze.cells[i][j].type === Cell.TYPE_EMPTY ? Cell.TYPE_BLOCKED : maze.cells[i][j].type;
                        }
                    }
                }
            });

            function setup() {
                const CANVAS_SIZE = 600;

                let canvas = createCanvas(CANVAS_SIZE, CANVAS_SIZE);
                canvas.parent('maze-container');
                background(200, 200, 200);
            }

            function draw() {
                if(maze !== null){
                    maze.draw();
                }
            }

        </script>
    </body>
</html>